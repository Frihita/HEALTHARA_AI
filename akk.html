<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Aaj Kya Khayein? | Healthara</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom styles for the spinner */
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: #059669;
      animation: spin 1s ease infinite;
    }
    .hidden {
      display: none;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-emerald-100 to-sky-100 min-h-screen">

  <div class="min-h-screen p-4 md:p-8">
    <div class="flex items-center gap-4 mb-8 max-w-4xl mx-auto">
      <button onclick="window.history.back()" class="rounded-full p-2 hover:bg-gray-200">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      <h1 class="text-2xl font-bold text-gray-900">Aaj Kya Khayein? üç≥</h1>
    </div>

    <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
      <div>
        <div class="bg-white rounded-2xl shadow-xl p-0 border-0">
          <div class="flex">
            <button id="tab-ingredients" class="flex-1 py-3 font-semibold border-b-2 border-emerald-500 bg-emerald-50">By Ingredients</button>
            <button id="tab-cravings" class="flex-1 py-3 font-semibold border-b-2 border-transparent hover:bg-emerald-50">Healthy Cravings</button>
          </div>
          <div id="ingredients-panel" class="p-6">
            <div class="text-lg font-bold mb-4">What's in your kitchen?</div>
            <div class="grid grid-cols-2 gap-4 mb-6 max-h-64 overflow-y-auto" id="ingredients-list">
              </div>
            <button id="find-recipe" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 rounded-lg flex items-center justify-center gap-2">
              <span id="find-recipe-spinner" class="hidden animate-spin"><svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-opacity="0.2"/><path d="M12 2a10 10 0 0 1 10 10" /></svg></span>
              <span>Find Recipe</span>
            </button>
          </div>
          <div id="cravings-panel" class="p-6 hidden">
            <div class="text-lg font-bold mb-4">Craving something unhealthy?</div>
            <div class="space-y-2 mb-6">
              <label for="craving-input" class="font-medium">Enter your craving</label>
              <input id="craving-input" type="text" placeholder="e.g., French Fries, Chocolate Cake" class="w-full border rounded-md p-2" />
            </div>
            <button id="find-alternative" class="w-full bg-fuchsia-600 hover:bg-fuchsia-700 text-white font-semibold py-2 rounded-lg flex items-center justify-center gap-2">
              <span id="find-alt-spinner" class="hidden animate-spin"><svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-opacity="0.2"/><path d="M12 2a10 10 0 0 1 10 10" /></svg></span>
              <span>Find Healthy Alternative</span>
            </button>
          </div>
          <div id="akk-error" class="text-red-500 text-sm px-6 py-2 hidden"></div>
        </div>
      </div>

      <div>
        <div class="bg-white rounded-2xl shadow-xl min-h-full border-0">
          <div class="p-6 border-b">
            <div class="text-lg font-bold">Your Custom Recipe</div>
          </div>
          <div class="p-6" id="recipe-result">
            <div class="text-center text-gray-500 h-64 flex flex-col items-center justify-center">
              <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M4 3v7a4 4 0 0 0 4 4h0a4 4 0 0 0 4-4V3" />
                <path d="M8 21v-4" />
                <path d="M18 8v13" />
                <path d="M18 3v3" />
              </svg>
              <p>Your generated recipe will appear here.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const ingredientsList = [
      'Chicken', 'Beef', 'Fish', 'Tofu', 'Eggs', 'Lentils', 'Chickpeas', 'Black Beans',
      'Tomato', 'Onion', 'Garlic', 'Spinach', 'Potato', 'Carrot', 'Bell Pepper', 'Mushroom',
      'Broccoli', 'Zucchini', 'Cucumber', 'Lettuce', 'Avocado', 'Corn', 'Sweet Potato',
      'Rice', 'Quinoa', 'Pasta', 'Bread', 'Oats', 'Flour',
      'Milk', 'Cheese', 'Yogurt', 'Butter', 'Almond Milk',
      'Lemon', 'Apple', 'Banana', 'Berries',
      'Olive Oil', 'Coconut Oil', 'Soy Sauce', 'Vinegar', 'Honey', 'Mustard', 'Nuts', 'Seeds'
    ];

    const ingredientsDiv = document.getElementById('ingredients-list');
    ingredientsList.forEach(item => {
      const id = 'ing-' + item.replace(/\s+/g, '-').toLowerCase();
      const div = document.createElement('div');
      div.className = "flex items-center space-x-2";
      div.innerHTML = `
        <input type="checkbox" id="${id}" value="${item}" class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500" />
        <label for="${id}" class="cursor-pointer">${item}</label>
      `;
      ingredientsDiv.appendChild(div);
    });

    const tabIngredients = document.getElementById('tab-ingredients');
    const tabCravings = document.getElementById('tab-cravings');
    const panelIngredients = document.getElementById('ingredients-panel');
    const panelCravings = document.getElementById('cravings-panel');
    const recipeResultDiv = document.getElementById('recipe-result');
    const errorDiv = document.getElementById('akk-error');

    tabIngredients.onclick = () => {
      tabIngredients.classList.add('border-emerald-500', 'bg-emerald-50');
      tabCravings.classList.remove('border-emerald-500', 'bg-emerald-50');
      panelIngredients.classList.remove('hidden');
      panelCravings.classList.add('hidden');
      errorDiv.classList.add('hidden');
    };
    tabCravings.onclick = () => {
      tabCravings.classList.add('border-emerald-500', 'bg-emerald-50');
      tabIngredients.classList.remove('border-emerald-500', 'bg-emerald-50');
      panelCravings.classList.remove('hidden');
      panelIngredients.classList.add('hidden');
      errorDiv.classList.add('hidden');
    };
    
    document.getElementById('find-recipe').onclick = async function() {
      const findRecipeBtn = this;
      const spinner = document.getElementById('find-recipe-spinner');
      const selected = Array.from(ingredientsDiv.querySelectorAll('input:checked')).map(i => i.value);

      if (selected.length === 0) {
        errorDiv.textContent = "Please select at least one ingredient.";
        errorDiv.classList.remove('hidden');
        return;
      }

      findRecipeBtn.disabled = true;
      spinner.classList.remove('hidden');
      errorDiv.classList.add('hidden');
      recipeResultDiv.innerHTML = `<div class="text-center text-gray-500 h-64 flex flex-col items-center justify-center">
                                      <svg class="animate-spin h-8 w-8 text-emerald-600 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.291 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                      </svg>
                                      <p>Generating a delicious recipe for you...</p>
                                   </div>`;

      const systemPrompt = "You are a professional chef specializing in healthy, quick, and easy recipes. Your task is to generate a complete recipe based on a list of ingredients. The output must be in a clean, human-readable markdown format. Provide a title, a short description, a list of ingredients, and step-by-step instructions. Finally, conclude with a single, helpful 'Chef's Tip' or 'Serving Suggestion' related to the recipe. Do not include any unnecessary text or conversational filler.";
      const userQuery = `Create a healthy and delicious recipe using the following ingredients: ${selected.join(', ')}`;
      const apiKey = "AIzaSyABdgOT5K9BLCg7MpPbYQAQHSwNYdZMrYA";
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
      const payload = {
        contents: [{ parts: [{ text: userQuery }] }],
        systemInstruction: {
          parts: [{ text: systemPrompt }]
        },
      };

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const result = await response.json();
        const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

        if (generatedText) {
          recipeResultDiv.innerHTML = `<div class="prose max-w-none">${generatedText}</div>`;
        } else {
          recipeResultDiv.innerHTML = `<div class="text-center text-red-500 h-64 flex flex-col items-center justify-center">
                                          <p>Could not generate a recipe. Please try again with different ingredients.</p>
                                        </div>`;
        }
      } catch (e) {
        console.error(e);
        recipeResultDiv.innerHTML = `<div class="text-center text-red-500 h-64 flex flex-col items-center justify-center">
                                        <p>An error occurred. Please check your network connection and try again.</p>
                                      </div>`;
      } finally {
        findRecipeBtn.disabled = false;
        spinner.classList.add('hidden');
      }
    };

    document.getElementById('find-alternative').onclick = async function() {
      const findAltBtn = this;
      const spinner = document.getElementById('find-alt-spinner');
      const craving = document.getElementById('craving-input').value.trim();

      if (!craving) {
        errorDiv.textContent = "Please enter your craving.";
        errorDiv.classList.remove('hidden');
        return;
      }

      findAltBtn.disabled = true;
      spinner.classList.remove('hidden');
      errorDiv.classList.add('hidden');
      recipeResultDiv.innerHTML = `<div class="text-center text-gray-500 h-64 flex flex-col items-center justify-center">
                                      <svg class="animate-spin h-8 w-8 text-fuchsia-600 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.291 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                      </svg>
                                      <p>Finding a healthy alternative for "${craving}"...</p>
                                   </div>`;

      const systemPrompt = "You are a health-conscious food expert. Given a craving, provide a single, concise healthy alternative. Your response should be a simple sentence. Do not add any extra text, titles, or conversational filler.";
      const userQuery = `Find a healthy alternative for the craving: ${craving}`;
      const apiKey = "AIzaSyABdgOT5K9BLCg7MpPbYQAQHSwNYdZMrYA";
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
      const payload = {
        contents: [{ parts: [{ text: userQuery }] }],
        systemInstruction: {
          parts: [{ text: systemPrompt }]
        },
      };

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const result = await response.json();
        const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

        if (generatedText) {
          recipeResultDiv.innerHTML = `<div class="prose max-w-none">
                                          <h2 class="text-2xl font-bold">üå± Healthy Alternative</h2>
                                          <p>${generatedText}</p>
                                       </div>`;
        } else {
          recipeResultDiv.innerHTML = `<div class="text-center text-red-500 h-64 flex flex-col items-center justify-center">
                                          <p>Could not find an alternative. Please try again.</p>
                                        </div>`;
        }
      } catch (e) {
        console.error(e);
        recipeResultDiv.innerHTML = `<div class="text-center text-red-500 h-64 flex flex-col items-center justify-center">
                                        <p>An error occurred. Please check your network connection and try again.</p>
                                      </div>`;
      } finally {
        findAltBtn.disabled = false;
        spinner.classList.add('hidden');
      }
    };
  </script>
</body>
</html>
